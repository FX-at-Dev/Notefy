<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Notefy - Web-Based Notes Making and Sharing Application</title>
  <link rel="stylesheet" href="./css/style.css" />
  <!-- CodeMirror theme (via CDN) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@codemirror/theme-one-dark@6.0.0/theme-one-dark.css" />
  <!-- Export Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docx@7.1.0/build/index.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

  <!-- Styles moved to css/style.css -->
  <script>
    // Apply tooltip preference immediately
    if (localStorage.getItem('showTooltips') !== 'false') {
      document.documentElement.classList.add('show-tooltips');
    }
  </script>
</head>
<body>
  <header class="topbar">
    <div class="left">
      <button id="btn-menu" class="icon-btn mobile-only" style="display:none">‚ò∞</button>
      <button id="btn-new" class="icon-btn" data-tooltip="New Note">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
      </button>
      
      <div class="dropdown">
        <button class="icon-btn" data-tooltip="Import">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
        </button>
        <div class="dropdown-content">
          <button id="btn-import-txt">Text / Markdown</button>
          <button id="btn-import-pdf">PDF Document</button>
          <button id="btn-import-ppt">PowerPoint</button>
        </div>
      </div>

      <div class="dropdown">
        <button class="icon-btn" data-tooltip="Export">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
        </button>
        <div class="dropdown-content">
          <button id="btn-export-md">Markdown (.md)</button>
          <button id="btn-export-pdf">PDF (.pdf)</button>
          <button id="btn-export-docx">Word (.docx)</button>
          <button id="btn-export-ppt">PowerPoint (.pptx)</button>
        </div>
      </div>

      <button id="btn-draw" class="icon-btn" data-tooltip="Draw">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19l7-7 3 3-7 7-3-3z"></path><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path><path d="M2 2l7.586 7.586"></path><circle cx="11" cy="11" r="2"></circle></svg>
      </button>
    </div>
    <div class="center">Notefy</div>
    <div class="right">
      <button id="btn-settings" class="icon-btn" title="Settings" style="padding: 8px;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
        </svg>
      </button>
      <button id="btn-profile" class="icon-btn" style="padding: 4px; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
        <div id="header-avatar" style="width: 32px; height: 32px; border-radius: 50%; background: var(--accent-primary); background-size: cover; background-position: center; display: flex; align-items: center; justify-content: center; font-size: 14px; color: white;">U</div>
      </button>
    </div>
  </header>

  <!-- Hidden File Inputs -->
  <input type="file" id="file-import-txt" accept=".txt,.md,.markdown" style="display:none" />
  <input type="file" id="file-import-pdf" accept=".pdf" style="display:none" />
  <input type="file" id="file-import-ppt" accept=".pptx" style="display:none" />
  <input type="file" id="file-attach-image" accept="image/*" style="display:none" />

  <div id="workspace" class="workspace">
    <!-- Mobile Overlay -->
    <div id="sidebar-overlay" class="sidebar-overlay"></div>
    <aside class="sidebar">
      <input id="search-input" placeholder="Search..." />
      <div class="sidebar-tabs">
        <button class="sidebar-tab active" data-tab="notes">Notes</button>
        <button class="sidebar-tab" data-tab="favorites">Favorites</button>
        <button class="sidebar-tab" data-tab="tags">Tags</button>
        <!-- Mobile Only Tabs -->
        <button class="sidebar-tab mobile-tab" data-tab="backlinks">Backlinks</button>
        <button class="sidebar-tab mobile-tab" data-tab="archive">Archive</button>
        <button class="sidebar-tab mobile-tab" data-tab="trash">Trash</button>
      </div>
      <div id="notes-list" class="notes-list"></div>
    </aside>

    <main class="editor-area">
      <div class="editor-header">
        <input id="note-title" placeholder="Untitled note" class="title-input" />
        <div class="formatting-toolbar">
          <button class="format-btn"><b>B</b></button>
          <button class="format-btn"><i>I</i></button>
          <button class="format-btn"><u>U</u></button>
          <span style="width:1px;background:rgba(255,255,255,0.1);margin:0 4px"></span>
          <button class="format-btn">H1</button>
          <button class="format-btn">H2</button>
          <button class="format-btn">Code</button>
          <span style="width:1px;background:rgba(255,255,255,0.1);margin:0 4px"></span>
          <button class="format-btn" id="btn-favorite" title="Toggle Favorite" style="color:var(--text-muted)">‚òÖ</button>
          <button class="format-btn" id="btn-archive" title="Archive Note">üì•</button>
          <button class="format-btn" id="btn-delete" title="Delete Note">üóëÔ∏è</button>
          <button class="format-btn" id="btn-attach-image" title="Attach Image">üñºÔ∏è</button>
          <div class="status" id="status-bar" style="margin-left:auto;font-size:12px;color:rgba(255,255,255,0.4)">Saved</div>
        </div>
      </div>

      <div class="panes">
        <section class="pane pane-left">
          <div id="editor-container" style="height:100%;min-height:320px;position:relative;">
            <!-- CodeMirror root (will be shown when rich editor initializes) -->
            <div id="cm-root" style="height:100%;min-height:320px;display:none;"></div>
            <!-- fallback textarea (shown only when CodeMirror fails) -->
            <textarea id="editor-fallback" style="display:none;"></textarea>
          </div>
        </section>

        <section class="pane pane-right">
          <div id="preview" class="preview"></div>
        </section>
      </div>
    </main>

    <aside class="rightbar">
      <div class="sidebar-tabs" style="margin-bottom: 1rem;">
        <button class="sidebar-tab active" data-tab="backlinks">Backlinks</button>
        <button class="sidebar-tab" data-tab="archive">Archive</button>
        <button class="sidebar-tab" data-tab="trash">Trash</button>
      </div>
      <div id="backlinks">No backlinks yet</div>
      <div id="right-notes-list" class="notes-list" style="display:none;"></div>
    </aside>
  </div>

  <!-- Drawpad modal -->
  <div id="draw-modal" class="modal hidden" role="dialog" aria-hidden="true">
    <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
      <button id="draw-save" class="btn">Save</button>
      <button id="draw-attach" class="btn">Attach</button>
      <button id="draw-clear" class="btn ghost">Clear</button>
      <button id="draw-close" class="btn ghost">Close</button>
      <label style="margin-left:auto">Brush:
        <input id="draw-size" type="range" min="1" max="30" value="4" />
      </label>
    </div>
    <div id="draw-container" class="draw-canvas"></div>
  </div>

  <!-- Quick Switcher modal -->
  <div id="qs-modal" class="modal hidden" role="dialog" aria-hidden="true">
    <input id="qs-input" placeholder="Quick switch (Ctrl/Cmd+P)" />
    <div id="qs-results"></div>
  </div>

  <!-- Import iframe modal (Option A: import.html loaded inside iframe + postMessage) -->
  <div id="import-iframe-modal" class="modal hidden" role="dialog" aria-hidden="true">
    <div class="import-iframe-inner" style="max-width:880px;width:100%;height:80vh;padding:12px;">
      <button id="import-iframe-close" class="btn ghost" style="float:right">Close</button>
      <div style="clear:both;height:8px"></div>
      <iframe id="import-iframe" src="about:blank" style="width:100%;height:calc(100% - 40px);border:0;border-radius:8px"></iframe>
    </div>
  </div>

  <!-- Inlined core frontend logic: attempts CodeMirror then falls back to textarea -->
  <script type="module" src="./js/editor.js"></script>
</body>
</html>
